<html><head>
<link rel="stylesheet" type="text/css" href="https://categoricaldata.net/css/simple.css" /></head><body><h1>example JDBCSQL</h1><pre>
//create some example data in a local temporary sql database. (close delay keeps H2 database alive across connections)
command load = exec_jdbc "jdbc:h2:mem:db1;DB_CLOSE_DELAY=-1" { 
"
DROP TABLE IF EXISTS Employee;
DROP TABLE IF EXISTS Department;" //multiple statements can be used, but many SQL engines (such as H2, CQL's internal engine) will only print the output of the first statement, and some require ?allowMultiQueries=true in the jdbc string 

"
CREATE TABLE Employee(
 id INT PRIMARY KEY,
 name VARCHAR(255),
 manager INT, 
 worksIn INT
)"

//a bug in the library for CQL's code editor prevents the correct highlighting of 
//multi-line quotes.  Starting the text on the line after the initial quote helps readability.
"
CREATE TABLE Department(
 id INT PRIMARY KEY,
 name VARCHAR(255),
 secretary INT,
)"
 
"
INSERT INTO Employee VALUES 
 (101, 'Alan', 103, 10), 
 (102, 'Camille', 102, 2), 
 (103, 'Andrey', 103, 10)"

"
INSERT INTO Department VALUES
 (10, 'Applied Math', 101),
 (2, 'Pure Math', 102)"

"
ALTER TABLE Employee ADD CONSTRAINT e1
 FOREIGN KEY (manager) REFERENCES Employee (id)"

"
ALTER TABLE Employee ADD CONSTRAINT e2 
 FOREIGN KEY (worksIn) REFERENCES Department (id)"

"
ALTER TABLE Department ADD CONSTRAINT d1
 FOREIGN KEY (secretary) REFERENCES Employee (id)"

// options always_reload = true //true forces pragmas to not be cached between runs (i.e., always run)
}  
 
/* When the JDBC class name and string are left blank, CQL uses the value of the option
    jdbc_default_string.  These can be set globally by placing,
   at the beginning of the file, for example:
   
  options
   
    jdbc_default_string = "jdbc:h2:mem:db1;DB_CLOSE_DELAY=-1"
 */
//look at the example data
command view0 = exec_jdbc "" {  //see note above!!!
"SELECT * FROM Department"
"SELECT * FROM Employee"
}

////////////////////////////////////////////////////////////////////////////////////////////////////////

schema S = literal : sql {
	entities
		Employee 
		Department
	foreign_keys
		manager   : Employee -&gt; Employee
		worksIn   : Employee -&gt; Department
		secretary : Department -&gt; Employee
	path_equations 
		Employee.manager.worksIn = Employee.worksIn
  		Department.secretary.worksIn = Department
  		Employee.manager.manager = Employee.manager
  	attributes
  		first last	: Employee -&gt; Varchar
     	age			: Employee -&gt; Integer
     	name 		: Department -&gt; Varchar
 }

//import an instance by providing queries for each entity
instance J = import_jdbc ""  : S {
//use name as first name
  //use null as last name
  //use id as age	
	Employee -&gt; "SELECT id, manager, worksIn, name AS first, NULL as last, id AS age FROM Employee"
	Department -&gt; "SELECT id, secretary, name FROM Department"

	options
		//aql by default prepends the entity to each imported ID, to get uniqueness across entities.
		//to import the IDs verbatim, set the option below to false
		prepend_entity_on_ids = false
}



//import a transform by providing queries for each entity
transform Jid = import_jdbc ""  : J -&gt; J {
	Employee -&gt; "SELECT id, id FROM Employee"
	Department -&gt; "SELECT id, id FROM Department"

	options
		prepend_entity_on_ids = false
}

//export the instance to SQL
command store1 = export_jdbc_instance J ""  "Exported"
{ options start_ids_at = 100 }

//view exported SQL instance
command view1 = exec_jdbc ""  { 
	"SELECT * FROM \"ExportedEmployee\""
	"SELECT * FROM \"ExportedDepartment\""
}

//export the transform to SQL
command store2 = export_jdbc_transform Jid ""  "ExportedTrans" 
 { options start_ids_at = 100 } //src
 { options start_ids_at = 100 } //dst

//view the exported SQL transform
command view2 = exec_jdbc ""  { 
	"SELECT * FROM ExportedTransEmployee"
	"SELECT * FROM ExportedTransDepartment"
}

//to import all the data in a SQL DB at once onto an auto-generated schema, use the following:
instance import_all_inst = import_jdbc_all "" 
//the schema can be obtained as
schema import_all_schema = schemaOf import_all_inst
//or
schema import_all_schema_2 = import_jdbc_all "" 


////////////////////////////////////////////////////////////
//
//execute command line actions as follows
//pragma cmdline1 = exec_cmdline  { 
//"ls -ltr"
//"echo hi"
//}
//
//execute actions as follows
//pragma js1 = exec_js  { 
//"javax.swing.JOptionPane.showMessageDialog(null, \"hello1\")"
//"javax.swing.JOptionPane.showMessageDialog(null, \"hello2\")"
//}

//store query evaluation as a view

query Q = literal : S -&gt; S {
	entity
		Employee -&gt; 
		{from e:Employee d:Department
		 where e.worksIn = d
		 attributes first -&gt; e.manager.first 
		        last -&gt; d.name 
		        age -&gt; e.age
		        foreign_keys manager -&gt; {e -&gt; e.manager
		            d -&gt; e.manager.worksIn}
		worksIn -&gt; {d -&gt; e.worksIn}
		}
		
		entity Department -&gt; {from d:Department 
		               attributes name -&gt; d.name
		               foreign_keys secretary -&gt; {e -&gt; d.secretary 
		              d -&gt; d}}
		
	
		
}

command store_id_query = export_jdbc_query Q "" "Exported" "View"

command view_view = exec_jdbc ""  { 
	"SELECT * FROM \"ViewEmployee\""
	"SELECT * FROM \"ViewDepartment\""
	"DROP VIEW \"ViewEmployee\""
	"DROP VIEW \"ViewDepartment\"" //clean up is important when re-running the program
}
</pre> Keywords:<br/></br>			<a href="queryquery_literal.html" >query_literal</a><br />
			<a href="schemaschema_var.html" >schema_var</a><br />
			<a href="commandexec_jdbc.html" >exec_jdbc</a><br />
			<a href="schemaschemaOf.html" >schemaOf</a><br />
			<a href="instanceimport_jdbc.html" >import_jdbc</a><br />
			<a href="commandexport_jdbc_query.html" >export_jdbc_query</a><br />
			<a href="transformimport_jdbc.html" >import_jdbc</a><br />
			<a href="commandexport_jdbc_transform.html" >export_jdbc_transform</a><br />
			<a href="commandexport_jdbc_instance.html" >export_jdbc_instance</a><br />
			<a href="instanceimport_jdbc_all.html" >import_jdbc_all</a><br />
			<a href="schemaimport_jdbc_all.html" >import_jdbc_all</a><br />
<br/>Options:<br/></br><a href="prepend_entity_on_ids.html" >prepend_entity_on_ids</a><br/>
<a href="start_ids_at.html" >start_ids_at</a><br/>

<br/></br>
<hr/><h3>instance import_all_inst</h3><div><table id="table372" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>DEPARTMENT</b></caption><tr><th onclick="sortTable('table372', 0)">ID</th><th onclick="sortTable('table372', 1)">ID</th><th onclick="sortTable('table372', 2)">NAME</th><th onclick="sortTable('table372', 3)">SECRETARY</th><th onclick="sortTable('table372', 4)">DEPARTMENT__SECRETARY__EMPLOYEE_ID</th></tr><tr><td>0</td><td>10</td><td>Applied Math</td><td>101</td><td>4</td></tr><tr><td>1</td><td>2</td><td>Pure Math</td><td>102</td><td>3</td></tr></table><table id="table373" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>EMPLOYEE</b></caption><tr><th onclick="sortTable('table373', 0)">ID</th><th onclick="sortTable('table373', 1)">ID</th><th onclick="sortTable('table373', 2)">MANAGER</th><th onclick="sortTable('table373', 3)">NAME</th><th onclick="sortTable('table373', 4)">WORKSIN</th><th onclick="sortTable('table373', 5)">EMPLOYEE__MANAGER__EMPLOYEE_ID</th><th onclick="sortTable('table373', 6)">EMPLOYEE__WORKSIN__DEPARTMENT_ID</th></tr><tr><td>2</td><td>103</td><td>103</td><td>Andrey</td><td>10</td><td>2</td><td>0</td></tr><tr><td>3</td><td>102</td><td>102</td><td>Camille</td><td>2</td><td>3</td><td>1</td></tr><tr><td>4</td><td>101</td><td>103</td><td>Alan</td><td>10</td><td>2</td><td>0</td></tr></table><table id="table374" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>EXPORTEDTRANSDEPARTMENT</b></caption><tr><th onclick="sortTable('table374', 0)">ID</th><th onclick="sortTable('table374', 1)">DSTID</th><th onclick="sortTable('table374', 2)">SRCID</th></tr><tr><td>5</td><td>103</td><td>103</td></tr><tr><td>6</td><td>104</td><td>104</td></tr></table><table id="table375" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>EXPORTEDTRANSEMPLOYEE</b></caption><tr><th onclick="sortTable('table375', 0)">ID</th><th onclick="sortTable('table375', 1)">DSTID</th><th onclick="sortTable('table375', 2)">SRCID</th></tr><tr><td>7</td><td>101</td><td>101</td></tr><tr><td>8</td><td>102</td><td>102</td></tr><tr><td>9</td><td>100</td><td>100</td></tr></table><table id="table376" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>ExportedDepartment</b></caption><tr><th onclick="sortTable('table376', 0)">ID</th><th onclick="sortTable('table376', 1)">id</th><th onclick="sortTable('table376', 2)">name</th><th onclick="sortTable('table376', 3)">secretary</th><th onclick="sortTable('table376', 4)">ExportedDepartment__secretary__ExportedEmployee_id</th></tr><tr><td>10</td><td>104</td><td>Applied Math</td><td>100</td><td>14</td></tr><tr><td>11</td><td>103</td><td>Pure Math</td><td>102</td><td>13</td></tr></table><table id="table377" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>ExportedEmployee</b></caption><tr><th onclick="sortTable('table377', 0)">ID</th><th onclick="sortTable('table377', 1)">age</th><th onclick="sortTable('table377', 2)">first</th><th onclick="sortTable('table377', 3)">id</th><th onclick="sortTable('table377', 4)">last</th><th onclick="sortTable('table377', 5)">manager</th><th onclick="sortTable('table377', 6)">worksIn</th><th onclick="sortTable('table377', 7)">ExportedEmployee__manager__ExportedEmployee_id</th><th onclick="sortTable('table377', 8)">ExportedEmployee__worksIn__ExportedDepartment_id</th></tr><tr><td>12</td><td>103</td><td>Andrey</td><td>101</td><td>?0</td><td>101</td><td>104</td><td>12</td><td>10</td></tr><tr><td>13</td><td>102</td><td>Camille</td><td>102</td><td>?1</td><td>102</td><td>103</td><td>13</td><td>11</td></tr><tr><td>14</td><td>101</td><td>Alan</td><td>100</td><td>?2</td><td>101</td><td>104</td><td>12</td><td>10</td></tr></table></div><br style="clear:both;"/><hr/><h3>instance J</h3><div><table id="table378" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>Department</b></caption><tr><th onclick="sortTable('table378', 0)">ID</th><th onclick="sortTable('table378', 1)">name</th><th onclick="sortTable('table378', 2)">secretary</th></tr><tr><td>0</td><td>Pure Math</td><td>3</td></tr><tr><td>1</td><td>Applied Math</td><td>2</td></tr></table><table id="table379" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>Employee</b></caption><tr><th onclick="sortTable('table379', 0)">ID</th><th onclick="sortTable('table379', 1)">age</th><th onclick="sortTable('table379', 2)">first</th><th onclick="sortTable('table379', 3)">last</th><th onclick="sortTable('table379', 4)">manager</th><th onclick="sortTable('table379', 5)">worksIn</th></tr><tr><td>2</td><td>101</td><td>Alan</td><td>?0</td><td>4</td><td>1</td></tr><tr><td>3</td><td>102</td><td>Camille</td><td>?1</td><td>3</td><td>0</td></tr><tr><td>4</td><td>103</td><td>Andrey</td><td>?2</td><td>4</td><td>1</td></tr></table></div><br style="clear:both;"/><hr/><h3>command view_view</h3><pre>START
SELECT * FROM "ViewEmployee"

id (e=100)(unfold1=104)(unfold0=101),  first Andrey,  age 101,  last Applied Math,  manager (e=101)(unfold1=104)(unfold0=101),  worksIn (d=104)(unfold2=100)
id (e=101)(unfold1=104)(unfold0=101),  first Andrey,  age 103,  last Applied Math,  manager (e=101)(unfold1=104)(unfold0=101),  worksIn (d=104)(unfold2=100)
id (e=102)(unfold1=103)(unfold0=102),  first Camille,  age 102,  last Pure Math,  manager (e=102)(unfold1=103)(unfold0=102),  worksIn (d=103)(unfold2=102)
END

START
SELECT * FROM "ViewDepartment"

id (d=103)(unfold2=102),  name Pure Math,  secretary (e=102)(unfold1=103)(unfold0=102)
id (d=104)(unfold2=100),  name Applied Math,  secretary (e=100)(unfold1=104)(unfold0=101)
END

START
DROP VIEW "ViewEmployee"

Updated 0 rows.
END

START
DROP VIEW "ViewDepartment"

Updated 0 rows.
END
</pre><hr/><h3>command view2</h3><pre>START
SELECT * FROM ExportedTransEmployee

SRCID 100,  DSTID 100
SRCID 101,  DSTID 101
SRCID 102,  DSTID 102
END

START
SELECT * FROM ExportedTransDepartment

SRCID 103,  DSTID 103
SRCID 104,  DSTID 104
END
</pre><hr/><h3>command store_id_query</h3><pre>export_jdbc_query drop view if exists "ViewEmployee"

create view "ViewEmployee" as   select concat(concat(concat('(e=', concat(convert(e."id", varchar), ')')), concat('(unfold1=', concat(convert(unfold1."id", varchar), ')'))), concat('(unfold0=', concat(convert(unfold0."id", varchar), ')'))) as "id", unfold0."first" as "first", e."age" as "age", unfold1."name" as "last", concat(concat(concat('(e=', concat(convert(convert(unfold0."id", varchar), varchar), ')')), concat('(unfold1=', concat(convert(convert(unfold0."worksIn", varchar), varchar), ')'))), concat('(unfold0=', concat(convert(convert(unfold0."manager", varchar), varchar), ')'))) as "manager", concat(concat('(d=', concat(convert(convert(unfold1."id", varchar), varchar), ')')), concat('(unfold2=', concat(convert(convert(unfold1."secretary", varchar), varchar), ')'))) as "worksIn"
from "ExportedEmployee" as e, "ExportedDepartment" as unfold1, "ExportedEmployee" as unfold0
  where unfold0."id" = e."manager" and unfold1."id" = e."worksIn"

drop view if exists "ViewDepartment"

create view "ViewDepartment" as   select concat(concat('(d=', concat(convert(d."id", varchar), ')')), concat('(unfold2=', concat(convert(unfold2."id", varchar), ')'))) as "id", d."name" as "name", concat(concat(concat('(e=', concat(convert(convert(unfold2."id", varchar), varchar), ')')), concat('(unfold1=', concat(convert(convert(unfold2."worksIn", varchar), varchar), ')'))), concat('(unfold0=', concat(convert(convert(unfold2."manager", varchar), varchar), ')'))) as "secretary"
from "ExportedDepartment" as d, "ExportedEmployee" as unfold2
  where unfold2."id" = d."secretary"</pre><hr/><h3>command store2</h3><pre>Exported 5 rows.</pre><hr/><h3>command store1</h3><pre>Exported 5 rows.</pre><hr/><h3>command view1</h3><pre>START
SELECT * FROM "ExportedEmployee"

id 100,  manager 101,  worksIn 104,  first Alan,  age 101,  last null
id 101,  manager 101,  worksIn 104,  first Andrey,  age 103,  last null
id 102,  manager 102,  worksIn 103,  first Camille,  age 102,  last null
END

START
SELECT * FROM "ExportedDepartment"

id 103,  secretary 102,  name Pure Math
id 104,  secretary 100,  name Applied Math
END
</pre><hr/><h3>command view0</h3><pre>START
SELECT * FROM Department

ID 2,  NAME Pure Math,  SECRETARY 102
ID 10,  NAME Applied Math,  SECRETARY 101
END

START
SELECT * FROM Employee

ID 101,  NAME Alan,  MANAGER 103,  WORKSIN 10
ID 102,  NAME Camille,  MANAGER 102,  WORKSIN 2
ID 103,  NAME Andrey,  MANAGER 103,  WORKSIN 10
END
</pre><hr/><h3>command load</h3><pre>START

DROP TABLE IF EXISTS Employee;
DROP TABLE IF EXISTS Department;

Updated 0 rows.
END

START

CREATE TABLE Employee(
 id INT PRIMARY KEY,
 name VARCHAR(255),
 manager INT, 
 worksIn INT
)

Updated 0 rows.
END

START

CREATE TABLE Department(
 id INT PRIMARY KEY,
 name VARCHAR(255),
 secretary INT,
)

Updated 0 rows.
END

START

INSERT INTO Employee VALUES 
 (101, 'Alan', 103, 10), 
 (102, 'Camille', 102, 2), 
 (103, 'Andrey', 103, 10)

Updated 3 rows.
END

START

INSERT INTO Department VALUES
 (10, 'Applied Math', 101),
 (2, 'Pure Math', 102)

Updated 2 rows.
END

START

ALTER TABLE Employee ADD CONSTRAINT e1
 FOREIGN KEY (manager) REFERENCES Employee (id)

Updated 0 rows.
END

START

ALTER TABLE Employee ADD CONSTRAINT e2 
 FOREIGN KEY (worksIn) REFERENCES Department (id)

Updated 0 rows.
END

START

ALTER TABLE Department ADD CONSTRAINT d1
 FOREIGN KEY (secretary) REFERENCES Employee (id)

Updated 0 rows.
END
</pre></body></html>