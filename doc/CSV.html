<html><head>
<link rel="stylesheet" type="text/css" href="https://categoricaldata.net/css/simple.css" /></head><body><h1>example CSV</h1><pre>
options
	always_reload = true
	
schema S0 = literal : sql {
	entities
		Employee
		Person
	foreign_keys
		eAsP : Employee -&gt; Person
	attributes
		ssn : Person -&gt; Integer
		eId : Employee -&gt; Integer
		eSsn  : Employee -&gt; Integer
	observation_equations
		eSsn = eAsP . ssn 					
}

/* 
 *  Person.csv is the file
 *   pId
 *   0
 *   1
 *   2
 *   
 *   Employee.csv is the file
 *    eId,is
 *    10,0
 *    11,1
 *    12,2
 */
command createCsvData = exec_js {
	"Java.type(\"catdata.Util\").writeFile(\"pId\\n0\\n1\\n2\", \"Person.csv\")"
	"Java.type(\"catdata.Util\").writeFile(\"eId,is\\n10,0\\n11,1\\n12,2\", \"Employee.csv\")"
}

instance I0 = import_csv "" : S0 {
	Employee -&gt; {Employee -&gt; eId   eAsP -&gt; is    eSsn -&gt; is}
	//eId -&gt; eId can be ommitted
	
	Person -&gt; {Person -&gt; pId  ssn -&gt; pId}
}


command exportCsvData = export_csv_instance I0 "exported" 
command exportCsvData2 = export_csv_transform (identity I0) "exported_trans.csv" 


//////////////////////////////////////////////


/* 
 * We show how to take the Person.csv file
 *   ssn,nameOf,Likes
 *   0,a,"a"
 *   1,b,"a,b,d"
 *   2,c ""
 *   
 * and create an CQL instance with 3 option-valued attributes, one per list element.  
 */


typeside Ty = literal {
	java_types
		String = "java.lang.String"
		List = "java.util.List"
		Option = "java.util.Optional"
		Integer = "java.lang.Integer"
	java_constants
		Integer = "return java.lang.Integer.parseInt(input[0])"
		String = "return input[0]"
		List = "return java.util.Arrays.asList(input[0].split(\",\"))"
		Option = "throw new RuntimeException()" //don't need to parse option-valued types
	java_functions
		at : List, Integer -&gt; Option = "return (input[1] &lt; input[0].size() ? java.util.Optional.of(input[0].get(input[1])) : java.util.Optional.empty())" 				
		of : String -&gt; Option = "return java.util.Optional.of(input[0])"
		get : Option -&gt; String = "return input[0].get()"
}

schema S = literal : Ty {
	entities
		Person
	attributes
		name : Person -&gt; String
		likes: Person -&gt; List 
}

command createCsvData2 = exec_js {
	"Java.type(\"catdata.Util\").writeFile(\"ssn,nameOf,Likes\\n0,a,a\\n1,b,\\\"a,b,d\\\"\\n2,c,\\\"\\\"\\n\", \"Person.csv\")"
}

instance I = import_csv "" : S {
	Person -&gt; {
		Person -&gt; ssn
		name -&gt; nameOf
		likes -&gt; Likes}
}

schema T = literal : Ty {
	imports 
		S
	attributes
		likes0: Person -&gt; Option 
		likes1: Person -&gt; Option
		likes2: Person -&gt; Option 
	observation_equations
		forall p. at(likes(p),0) = likes0(p)
		forall p. at(likes(p),1) = likes1(p)
		forall p. at(likes(p),2) = likes2(p)
}

//J = sigma_{inclusion mapping} I
instance J = literal : T {
	imports 
		I
}

//////////////////////////////////////////////////////////

//Migrating the java-valued optional attributes onto foreign keys falls outside
//of the safe java fragment.  But here is a non-java solution of the 
//essence of the migration.


typeside Ty2 = literal {
	types
		String
		Option
	constants
		a b c d e  : String
		none : Option
	functions
		some : String -&gt; Option
//		get : 
//	equations	
}

schema S2 = literal : Ty2 {
	entities
		X
	attributes
		_id : X -&gt; String
		att : X -&gt; Option	
}

schema T2 = literal : Ty2 {
	imports
		S2
	foreign_keys
		f : X -&gt; X
	path_equations
		X.f.f = X.f	//needed for finiteness of J2
}

constraints C = literal : T2 {
	forall x1 x2 : X
	where att(x1) = some(_id(x2))
-&gt;
	where x1.f = x2	

	//todo: why can't this ED be used to get rid of the path equation in T2?
	//forall x : X
	//-&gt;
	//where x.f.f = x.f 
}

instance I2 = literal : T2 {
	generators
		x1 x2 x3 x4: X
	equations
		x1._id = a  x1.att = some(b)    
		x2._id = b  x2.att = none      
		x3._id = c  x3.att = some(e)   
		x4._id = d  x4.att = some(d)
}

//set the foreign keys to be the join of att and _id
instance J2 = chase C I2
</pre> Keywords:<br/></br>			<a href="typesidetypeside_literal.html" >typeside_literal</a><br />
			<a href="schemaschema_literal.html" >schema_literal</a><br />
			<a href="instancechase.html" >chase</a><br />
			<a href="commandexec_js.html" >exec_js</a><br />
			<a href="commandexport_csv_instance.html" >export_csv_instance</a><br />
			<a href="instanceinstance_literal.html" >instance_literal</a><br />
			<a href="instanceimport_csv.html" >import_csv</a><br />
			<a href="commandcommand_identity.html" >command_identity</a><br />
			<a href="constraintsconstraints_literal.html" >constraints_literal</a><br />
<br/>Options:<br/></br>
<br/></br>
<hr/><h3>instance J2</h3><div><table id="table30" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>X</b></caption><tr><th onclick="sortTable('table30', 0)">ID</th><th onclick="sortTable('table30', 1)">_id</th><th onclick="sortTable('table30', 2)">att</th><th onclick="sortTable('table30', 3)">f</th></tr><tr><td>0</td><td>a</td><td>some(b)</td><td>1</td></tr><tr><td>1</td><td>b</td><td>none</td><td>1</td></tr><tr><td>2</td><td>c</td><td>some(e)</td><td>3</td></tr><tr><td>3</td><td>?0</td><td>?1</td><td>3</td></tr><tr><td>4</td><td>d</td><td>some(d)</td><td>4</td></tr></table></div><br style="clear:both;"/><hr/><h3>instance I2</h3><div><table id="table31" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>X</b></caption><tr><th onclick="sortTable('table31', 0)">ID</th><th onclick="sortTable('table31', 1)">_id</th><th onclick="sortTable('table31', 2)">att</th><th onclick="sortTable('table31', 3)">f</th></tr><tr><td>0</td><td>d</td><td>some(d)</td><td>1</td></tr><tr><td>1</td><td>?0</td><td>?1</td><td>1</td></tr><tr><td>2</td><td>c</td><td>some(e)</td><td>3</td></tr><tr><td>3</td><td>?2</td><td>?3</td><td>3</td></tr><tr><td>4</td><td>a</td><td>some(b)</td><td>5</td></tr><tr><td>5</td><td>?4</td><td>?5</td><td>5</td></tr><tr><td>6</td><td>b</td><td>none</td><td>7</td></tr><tr><td>7</td><td>?6</td><td>?7</td><td>7</td></tr></table></div><br style="clear:both;"/><hr/><h3>instance I0</h3><div><table id="table32" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>Employee</b></caption><tr><th onclick="sortTable('table32', 0)">ID</th><th onclick="sortTable('table32', 1)">eId</th><th onclick="sortTable('table32', 2)">eSsn</th><th onclick="sortTable('table32', 3)">eAsP</th></tr><tr><td>0</td><td>10</td><td>0</td><td>3</td></tr><tr><td>1</td><td>11</td><td>1</td><td>4</td></tr><tr><td>2</td><td>12</td><td>2</td><td>5</td></tr></table><table id="table33" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>Person</b></caption><tr><th onclick="sortTable('table33', 0)">ID</th><th onclick="sortTable('table33', 1)">ssn</th></tr><tr><td>3</td><td>0</td></tr><tr><td>4</td><td>1</td></tr><tr><td>5</td><td>2</td></tr></table></div><br style="clear:both;"/><hr/><h3>instance J</h3><div><table id="table34" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>Person</b></caption><tr><th onclick="sortTable('table34', 0)">ID</th><th onclick="sortTable('table34', 1)">likes</th><th onclick="sortTable('table34', 2)">likes0</th><th onclick="sortTable('table34', 3)">likes1</th><th onclick="sortTable('table34', 4)">likes2</th><th onclick="sortTable('table34', 5)">name</th></tr><tr><td>0</td><td>[a, b, d]</td><td>Optional[a]</td><td>Optional[b]</td><td>Optional[d]</td><td>b</td></tr><tr><td>1</td><td>[]</td><td>Optional[]</td><td>Optional.empty</td><td>Optional.empty</td><td>c</td></tr><tr><td>2</td><td>[a]</td><td>Optional[a]</td><td>Optional.empty</td><td>Optional.empty</td><td>a</td></tr></table></div><br style="clear:both;"/><hr/><h3>instance I</h3><div><table id="table35" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>Person</b></caption><tr><th onclick="sortTable('table35', 0)">ID</th><th onclick="sortTable('table35', 1)">likes</th><th onclick="sortTable('table35', 2)">name</th></tr><tr><td>0</td><td>[a]</td><td>a</td></tr><tr><td>1</td><td>[a, b, d]</td><td>b</td></tr><tr><td>2</td><td>[]</td><td>c</td></tr></table></div><br style="clear:both;"/><hr/><h3>command createCsvData</h3><pre>Java.type("catdata.Util").writeFile("pId\n0\n1\n2", "Person.csv")
Java.type("catdata.Util").writeFile("eId,is\n10,0\n11,1\n12,2", "Employee.csv")</pre><hr/><h3>command createCsvData2</h3><pre>Java.type("catdata.Util").writeFile("ssn,nameOf,Likes\n0,a,a\n1,b,\"a,b,d\"\n2,c,\"\"\n", "Person.csv")</pre><hr/><h3>command exportCsvData2</h3><pre>Exported to exported_trans.csv.</pre><hr/><h3>command exportCsvData</h3><pre>Export to exported/.</pre></body></html>